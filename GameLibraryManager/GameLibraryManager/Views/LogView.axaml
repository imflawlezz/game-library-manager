<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:GameLibraryManager.ViewModels"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             xmlns:converters="using:GameLibraryManager.Converters"
             xmlns:spinner="using:GameLibraryManager.Controls"
             x:Class="GameLibraryManager.Views.LogView"
             x:DataType="vm:LogViewModel">
    
    <Grid RowDefinitions="*">
        
        <Border Grid.Row="0"
                Background="#161B22"
                CornerRadius="12"
                BorderBrush="#30363D"
                BorderThickness="1"
                ClipToBounds="True">
            <Grid RowDefinitions="Auto,*">
                
                <Grid Grid.Row="1">
                    <DataGrid ItemsSource="{Binding LogEntries}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              GridLinesVisibility="None"
                              HeadersVisibility="Column"
                              SelectionMode="Single"
                              Background="Transparent"
                              RowBackground="Transparent"
                              CanUserReorderColumns="False"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True"
                              IsVisible="{Binding !IsLoading}">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="ID" 
                                                    Width="70"
                                                    CanUserResize="True"
                                                    CanUserSort="True"
                                                    SortMemberPath="LogID"
                                                    MinWidth="60">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding LogID}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Foreground="#6E7681"
                                                   VerticalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridTemplateColumn Header="Timestamp" 
                                                    Width="150"
                                                    CanUserResize="True"
                                                    CanUserSort="True"
                                                    SortMemberPath="Timestamp"
                                                    MinWidth="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                            <i:Icon Value="fa-solid fa-clock" 
                                                    FontSize="11"
                                                    Foreground="#6E7681"
                                                    VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"
                                                       FontSize="12"
                                                       Foreground="#8B949E"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridTemplateColumn Header="User" 
                                                    Width="130"
                                                    CanUserResize="True"
                                                    CanUserSort="True"
                                                    SortMemberPath="Username"
                                                    MinWidth="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                            <i:Icon Value="fa-solid fa-user" 
                                                    FontSize="11"
                                                    Foreground="#6E7681"
                                                    VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Username}"
                                                       FontSize="13"
                                                       Foreground="#C9D1D9"
                                                       FontWeight="Medium"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridTemplateColumn Header="Table" 
                                                    Width="110"
                                                    CanUserResize="True"
                                                    CanUserSort="True"
                                                    SortMemberPath="TableName"
                                                    MinWidth="90">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding TableName}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   VerticalAlignment="Center">
                                            <TextBlock.Foreground>
                                                <SolidColorBrush Color="{Binding TableName, Converter={StaticResource TableNameColorConverter}}"/>
                                            </TextBlock.Foreground>
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridTemplateColumn Header="Action" 
                                                    Width="120"
                                                    CanUserResize="True"
                                                    CanUserSort="True"
                                                    SortMemberPath="Action"
                                                    MinWidth="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                            <i:Icon Value="{Binding Action, Converter={StaticResource ActionIconConverter}}" 
                                                    FontSize="12"
                                                    VerticalAlignment="Center">
                                                <i:Icon.Foreground>
                                                    <SolidColorBrush Color="{Binding Action, Converter={StaticResource ActionColorConverter}}"/>
                                                </i:Icon.Foreground>
                                            </i:Icon>
                                            <TextBlock Text="{Binding Action}"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"
                                                       VerticalAlignment="Center">
                                                <TextBlock.Foreground>
                                                    <SolidColorBrush Color="{Binding Action, Converter={StaticResource ActionColorConverter}}"/>
                                                </TextBlock.Foreground>
                                            </TextBlock>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridTemplateColumn Header="Field" 
                                                    Width="180"
                                                    CanUserResize="True"
                                                    CanUserSort="True"
                                                    SortMemberPath="FieldName"
                                                    MinWidth="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding FieldName}"
                                                   FontSize="12"
                                                   Foreground="#8B949E"
                                                   FontStyle="Italic"
                                                   VerticalAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Old Value" 
                                                     Width="200"
                                                     CanUserResize="True"
                                                     CanUserSort="True"
                                                     SortMemberPath="OldValue"
                                                     MinWidth="150">
                                <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                        <StackPanel Orientation="Horizontal" 
                                                        Spacing="8"
                                                        VerticalAlignment="Center"
                                                        IsVisible="{Binding OldValue, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                <TextBlock Text="{Binding OldValue}"
                                                           FontSize="13"
                                                           Foreground="#8B949E"
                                                           VerticalAlignment="Center"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextWrapping="NoWrap"
                                                           MaxWidth="160"/>
                                            <Button Command="{Binding $parent[DataGrid].DataContext.CopyToClipboardCommand}"
                                                        CommandParameter="{Binding OldValue}"
                                                        Classes="icon"
                                                        Padding="4"
                                                        ToolTip.Tip="Copy to clipboard">
                                                    <Button.IsVisible>
                                                        <MultiBinding Converter="{StaticResource ShouldShowCopyConverter}">
                                                            <Binding Path="OldValue"/>
                                                            <Binding Path="FieldName"/>
                                                        <Binding Path="$parent[DataGrid].DataContext"/>
                                                        </MultiBinding>
                                                    </Button.IsVisible>
                                                    <i:Icon Value="fa-solid fa-copy" 
                                                            FontSize="12"
                                                            Foreground="#6E7681"/>
                                                </Button>
                                            </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="New Value" 
                                                     Width="200"
                                                     CanUserResize="True"
                                                     CanUserSort="True"
                                                     SortMemberPath="NewValue"
                                                     MinWidth="150">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" 
                                                        Spacing="8"
                                                        VerticalAlignment="Center"
                                                        IsVisible="{Binding NewValue, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                <TextBlock Text="{Binding NewValue}"
                                                           FontSize="13"
                                                           Foreground="#F0F6FC"
                                                           VerticalAlignment="Center"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextWrapping="NoWrap"
                                                           MaxWidth="160"/>
                                            <Button Command="{Binding $parent[DataGrid].DataContext.CopyToClipboardCommand}"
                                                        CommandParameter="{Binding NewValue}"
                                                        Classes="icon"
                                                        Padding="4"
                                                        ToolTip.Tip="Copy to clipboard">
                                                    <Button.IsVisible>
                                                        <MultiBinding Converter="{StaticResource ShouldShowCopyConverter}">
                                                            <Binding Path="NewValue"/>
                                                            <Binding Path="FieldName"/>
                                                        <Binding Path="$parent[DataGrid].DataContext"/>
                                                        </MultiBinding>
                                                    </Button.IsVisible>
                                                    <i:Icon Value="fa-solid fa-copy" 
                                                            FontSize="12"
                                                            Foreground="#6E7681"/>
                                                </Button>
                                            </StackPanel>
                                </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    
                    <Border Background="#E00D1117"
                            IsVisible="{Binding IsLoading}">
                        <spinner:LoadingSpinner Text="Loading audit log"/>
                    </Border>
                    
                    <Border IsVisible="{Binding IsEmpty}"
                            Background="#161B22"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Stretch">
                        <StackPanel VerticalAlignment="Center" 
                                    HorizontalAlignment="Center"
                                    Spacing="16">
                            <i:Icon Value="fa-solid fa-file-lines" 
                                    FontSize="48"
                                    Foreground="#6E7681"/>
                            <TextBlock Text="No log entries found"
                                       FontSize="16"
                                       Foreground="#8B949E"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
