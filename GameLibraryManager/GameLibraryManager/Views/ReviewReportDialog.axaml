<Window xmlns="https://github.com/avaloniaui"
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
       xmlns:vm="using:GameLibraryManager.ViewModels"
       xmlns:i="https://github.com/projektanker/icons.avalonia"
       xmlns:controls="using:GameLibraryManager.Controls"
       xmlns:converters="using:GameLibraryManager.Converters"
       x:Class="GameLibraryManager.Views.ReviewReportDialog"
       x:DataType="vm:ReviewReportDialogViewModel"
       Title="Review Report"
       Width="600"
       Height="700"
       MinWidth="500"
       MinHeight="500"
       WindowStartupLocation="CenterOwner"
       CanResize="True"
       Background="#0D1117">
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <Border Grid.Row="0"
                Background="#161B22"
                Padding="24,20"
                BorderBrush="#30363D"
                BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Border Width="40" Height="40"
                        CornerRadius="10"
                        Background="#21262D">
                    <i:Icon Value="fa-solid fa-clipboard-check" 
                            FontSize="18"
                            Foreground="#58A6FF"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"/>
                </Border>
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Review Report"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="#F0F6FC"/>
                    <TextBlock Text="Review and respond to the report"
                               FontSize="13"
                               Foreground="#8B949E"/>
                </StackPanel>
            </StackPanel>
        </Border>
        
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel Spacing="24" Margin="32,24">
                
                <Border Background="#161B22"
                        CornerRadius="12"
                        Padding="20"
                        BorderBrush="#30363D"
                        BorderThickness="1">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Report.Type}"
                                           FontSize="12"
                                           Foreground="#8B949E"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="by"
                                           FontSize="12"
                                           Foreground="#6E7681"
                                           VerticalAlignment="Center"/>
                                <Border Width="24" Height="24"
                                        CornerRadius="12"
                                        Background="#30363D"
                                        ClipToBounds="True"
                                        VerticalAlignment="Center"
                                        Margin="6,0,0,0">
                                    <Panel>
                                        <Border Background="#58A6FF"
                                                IsVisible="{Binding Report.CreatedByProfileImageURL, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                                            <i:Icon Value="fa-solid fa-user" 
                                                    FontSize="12"
                                                    Foreground="#0D1117"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"/>
                                        </Border>
                                        <controls:AsyncImage Source="{Binding Report.CreatedByProfileImageURL}"
                                                             HorizontalAlignment="Stretch"
                                                             VerticalAlignment="Stretch"
                                                             IsVisible="{Binding Report.CreatedByProfileImageURL, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </Panel>
                                </Border>
                                <TextBlock Text="{Binding Report.CreatedByUsername}"
                                           FontSize="12"
                                           Foreground="#8B949E"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="•"
                                           FontSize="12"
                                           Foreground="#6E7681"
                                           Margin="6,0,6,0"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding Report.CreatedAt, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"
                                           FontSize="12"
                                           Foreground="#8B949E"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                        <TextBlock Text="{Binding Report.Title}"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Foreground="#F0F6FC"
                                   TextWrapping="Wrap"/>
                        <TextBlock Text="{Binding Report.Content}"
                                   FontSize="14"
                                   Foreground="#C9D1D9"
                                   TextWrapping="Wrap"
                                   LineHeight="22"/>
                    </StackPanel>
                </Border>
                
                <Border Background="#161B22"
                        CornerRadius="12"
                        Padding="20"
                        BorderBrush="#30363D"
                        BorderThickness="1"
                        IsVisible="{Binding Report.ReviewedByUsername, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" 
                                    Spacing="8"
                                    VerticalAlignment="Center">
                            <i:Icon Value="{Binding Report.Status, Converter={StaticResource StatusIconConverter}}" 
                                    FontSize="14"
                                    VerticalAlignment="Center">
                                <i:Icon.Foreground>
                                    <SolidColorBrush Color="{Binding Report.Status, Converter={StaticResource StatusColorConverter}}"/>
                                </i:Icon.Foreground>
                            </i:Icon>
                            <TextBlock Text="{Binding Report.Status}"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Foreground="#8B949E"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="by"
                                       FontSize="12"
                                       Foreground="#6E7681"
                                       VerticalAlignment="Center"/>
                            <Border Width="24" Height="24"
                                    CornerRadius="12"
                                    Background="#30363D"
                                    ClipToBounds="True"
                                    VerticalAlignment="Center"
                                    Margin="6,0,0,0">
                                <Panel>
                                    <Border Background="#58A6FF"
                                            IsVisible="{Binding Report.ReviewedByProfileImageURL, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                                        <i:Icon Value="fa-solid fa-user" 
                                                FontSize="12"
                                                Foreground="#0D1117"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                                    </Border>
                                    <controls:AsyncImage Source="{Binding Report.ReviewedByProfileImageURL}"
                                                         HorizontalAlignment="Stretch"
                                                         VerticalAlignment="Stretch"
                                                         IsVisible="{Binding Report.ReviewedByProfileImageURL, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                </Panel>
                            </Border>
                            <TextBlock Text="{Binding Report.ReviewedByUsername}"
                                       FontSize="12"
                                       Foreground="#8B949E"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="•"
                                       FontSize="12"
                                       Foreground="#6E7681"
                                       Margin="6,0,6,0"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding Report.ReviewedAt, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"
                                       FontSize="12"
                                       Foreground="#8B949E"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding AdminNotes}"
                                   FontSize="14"
                                   Foreground="#C9D1D9"
                                   TextWrapping="Wrap"
                                   LineHeight="22"
                                   IsVisible="{Binding AdminNotes, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                    </StackPanel>
                </Border>
                
                <StackPanel Spacing="16" IsVisible="{Binding !IsReadOnly}">
                    <TextBlock Text="Status *"
                               FontSize="13"
                               FontWeight="Medium"
                               Foreground="#8B949E"/>
                    <ComboBox ItemsSource="{Binding StatusOptions}"
                              SelectedItem="{Binding SelectedStatus}"
                              HorizontalAlignment="Stretch"/>
                </StackPanel>
                
                <StackPanel Spacing="16" IsVisible="{Binding !IsReadOnly}">
                    <TextBlock Text="Admin Notes"
                               FontSize="13"
                               FontWeight="Medium"
                               Foreground="#8B949E"/>
                    <Grid>
                        <TextBox Text="{Binding AdminNotes}"
                                 Watermark="Add notes about this review (optional)..."
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 MinHeight="150"
                                 MaxLength="2000"
                                 Padding="40,10,12,10"/>
                        <i:Icon Value="fa-solid fa-comment" 
                                FontSize="14"
                                Foreground="#6E7681"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top"
                                Margin="12,12,0,0"/>
                    </Grid>
                </StackPanel>
                
            </StackPanel>
        </ScrollViewer>
        
        <Border Grid.Row="2"
                Background="#161B22"
                Padding="24,20"
                BorderBrush="#30363D"
                BorderThickness="0,1,0,0">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <Button Grid.Column="1"
                        Command="{Binding CancelCommand}"
                        Content="Close"
                        Margin="0,0,12,0"
                        MinWidth="100"
                        Height="40"
                        IsEnabled="{Binding !IsSubmitting}"/>
                <Button Grid.Column="2"
                        Command="{Binding SubmitReviewCommand}"
                        Classes="primary"
                        MinWidth="140"
                        Height="40"
                        IsEnabled="{Binding !IsSubmitting}"
                        IsVisible="{Binding !IsReadOnly}">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                        <i:Icon Value="fa-solid fa-check" FontSize="14" IsVisible="{Binding !IsSubmitting}"/>
                        <TextBlock Text="Submit Review" 
                                   FontWeight="Medium"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding !IsSubmitting}"/>
                        <TextBlock Text="Submitting..." 
                                   FontWeight="Medium"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding IsSubmitting}"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>

